---

---

<div
    class="bg-white rounded-3xl shadow-sm border border-brand-light overflow-hidden mb-16"
>
    <div
        class="bg-brand-accent text-white text-center py-4 font-bold tracking-wider flex items-center justify-center gap-2"
    >
        <span>ğŸ§®</span> æ–™é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    </div>
    <div class="p-6 md:p-10">
        <p class="text-sm text-gray-500 mb-8 text-center">
            ã”å¸Œæœ›ã®æ¡ä»¶ã‚’é¸æŠã—ã¦ã€æ¦‚ç®—æ–™é‡‘ã‚’ç¢ºèªã§ãã¾ã™ã€‚
        </p>

        <div class="grid md:grid-cols-2 gap-8 mb-8">
            <div class="space-y-6">
                <!-- Basic Settings -->
                <div>
                    <label class="block text-brand-accent font-bold mb-2">
                        ã”åˆ©ç”¨æ—¥æ™‚
                    </label>
                    <div class="flex items-center gap-2 mb-2">
                        <select
                            id="start-time"
                            class="w-full bg-gray-50 border border-brand-light rounded-lg p-3 focus:outline-none focus:border-brand-main font-bold text-center"
                        >
                            <!-- Generated by JS -->
                        </select>
                        <span class="text-brand-text font-bold">ã€œ</span>
                        <select
                            id="end-time"
                            class="w-full bg-gray-50 border border-brand-light rounded-lg p-3 focus:outline-none focus:border-brand-main font-bold text-center"
                        >
                            <!-- Generated by JS -->
                        </select>
                    </div>
                    <div class="text-center text-sm font-bold text-brand-main">
                        åˆè¨ˆ: <span id="total-hours-display">0</span> æ™‚é–“
                    </div>
                    <p class="text-xs text-gray-400 mt-1 text-center">
                        â€»æœ€ä½3æ™‚é–“ã‹ã‚‰æ‰¿ã‚Šã¾ã™
                    </p>
                </div>

                <div>
                    <label class="block text-brand-accent font-bold mb-2">
                        ãŠå­æ§˜ã®äººæ•°
                    </label>
                    <select
                        id="children-count"
                        class="w-full bg-gray-50 border border-brand-light rounded-lg p-3 focus:outline-none focus:border-brand-main font-bold"
                    >
                        <option value="1">1äºº</option>
                        <option value="2">2äºº (+500å††/h)</option>
                        <option value="3">3äºº (+1000å††/h)</option>
                    </select>
                </div>

                <!-- Time Zone Surcharges (Read Only) -->
                <div class="bg-brand-base/10 rounded-xl p-4">
                    <label
                        class="block text-brand-accent font-bold mb-3 text-sm"
                    >
                        æ™‚é–“å¸¯å‰²å¢—ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰
                    </label>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-brand-text"
                                >æ—©æœ (6:00-9:00)</span
                            >
                            <span class="font-bold text-brand-accent"
                                ><span id="early-hours-display">0</span> h</span
                            >
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-brand-text"
                                >å¤•æ–¹ (18:00-20:00)</span
                            >
                            <span class="font-bold text-brand-accent"
                                ><span id="evening-hours-display">0</span> h</span
                            >
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-brand-text"
                                >å¤œé–“ (20:00-23:00)</span
                            >
                            <span class="font-bold text-brand-accent"
                                ><span id="night-hours-display">0</span> h</span
                            >
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Additional Options -->
                <div>
                    <label class="block text-brand-accent font-bold mb-2">
                        è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³
                    </label>
                    <div class="space-y-2">
                        <label
                            class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-brand-base/10 transition-colors"
                        >
                            <input
                                type="checkbox"
                                id="is-weekend"
                                class="w-5 h-5 text-brand-main rounded border-gray-300 focus:ring-brand-main"
                            />
                            <span class="font-bold text-gray-700"
                                >åœŸæ—¥ç¥æ—¥åˆ©ç”¨</span
                            >
                            <span
                                class="text-xs text-brand-main ml-auto font-bold"
                                >åŸºæœ¬æ–™é‡‘+20%</span
                            >
                        </label>
                        <label
                            class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-brand-base/10 transition-colors"
                        >
                            <input
                                type="checkbox"
                                id="is-remote"
                                class="w-5 h-5 text-brand-main rounded border-gray-300 focus:ring-brand-main"
                            />
                            <span class="font-bold text-gray-700"
                                >é æ–¹ã‚¨ãƒªã‚¢</span
                            >
                            <span
                                class="text-xs text-brand-main ml-auto font-bold"
                                >+1,000å††/å›</span
                            >
                        </label>
                        <label
                            class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-brand-base/10 transition-colors"
                        >
                            <input
                                type="checkbox"
                                id="is-sick"
                                class="w-5 h-5 text-brand-main rounded border-gray-300 focus:ring-brand-main"
                            />
                            <span class="font-bold text-gray-700"
                                >ç—…å…ãƒ»ç—…å¾Œå…ä¿è‚²</span
                            >
                            <span
                                class="text-xs text-brand-main ml-auto font-bold"
                                >+500å††/h</span
                            >
                        </label>
                    </div>
                </div>

                <!-- Result Display -->
                <div
                    class="bg-brand-accent text-white rounded-2xl p-6 text-center mt-auto"
                >
                    <div class="text-sm opacity-80 mb-2">æ¦‚ç®—è¦‹ç©ã‚‚ã‚Šé‡‘é¡</div>
                    <div class="flex items-end justify-center gap-1">
                        <span
                            class="text-4xl md:text-5xl font-bold tracking-tight"
                            id="total-price">0</span
                        >
                        <span class="text-lg pb-1">å††</span>
                    </div>
                    <div
                        class="mt-2 text-xs opacity-70 border-t border-white/20 pt-2"
                    >
                        äº¤é€šè²»ã¯åˆ¥é€”å®Ÿè²»è«‹æ±‚ã¨ãªã‚Šã¾ã™
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Constants
    const BASE_RATE = 2800;

    // Elements
    const startTimeSelect = document.getElementById(
        "start-time",
    ) as HTMLSelectElement;
    const endTimeSelect = document.getElementById(
        "end-time",
    ) as HTMLSelectElement;
    const childrenCountSelect = document.getElementById(
        "children-count",
    ) as HTMLSelectElement;
    const isWeekendCheckbox = document.getElementById(
        "is-weekend",
    ) as HTMLInputElement;
    const isRemoteCheckbox = document.getElementById(
        "is-remote",
    ) as HTMLInputElement;
    const isSickCheckbox = document.getElementById(
        "is-sick",
    ) as HTMLInputElement;
    const totalPriceDisplay = document.getElementById(
        "total-price",
    ) as HTMLElement;
    const totalHoursDisplay = document.getElementById(
        "total-hours-display",
    ) as HTMLElement;
    const earlyHoursDisplay = document.getElementById(
        "early-hours-display",
    ) as HTMLElement;
    const eveningHoursDisplay = document.getElementById(
        "evening-hours-display",
    ) as HTMLElement;
    const nightHoursDisplay = document.getElementById(
        "night-hours-display",
    ) as HTMLElement;

    // Initialize Time Options
    function initTimeOptions() {
        // Start time: 6:00 to 22:00
        for (let h = 6; h <= 22; h++) {
            for (let m = 0; m < 60; m += 30) {
                if (h === 22 && m > 0) break; // End at 22:00 start
                const timeString = `${h.toString().padStart(2, "0")}:${m.toString().padStart(2, "0")}`;
                const option = document.createElement("option");
                option.value = (h + m / 60).toString();
                option.text = timeString;
                startTimeSelect.add(option);
            }
        }
        // Set default start to 9:00
        startTimeSelect.value = "9";
        updateEndTimeOptions();
    }

    function updateEndTimeOptions() {
        const startVal = parseFloat(startTimeSelect.value);
        const currentEndVal = parseFloat(endTimeSelect.value);
        endTimeSelect.innerHTML = ""; // Clear existing

        // End time: Start + 0.5h to 23:59 (approx 24)
        // Max end time is 24:00 for simplicity in calculation
        let firstValidEnd = -1;

        for (let h = 6; h <= 24; h++) {
            for (let m = 0; m < 60; m += 30) {
                const val = h + m / 60;
                if (val <= startVal) continue; // End must be after start

                const timeString =
                    val === 24
                        ? "24:00"
                        : `${h.toString().padStart(2, "0")}:${m.toString().padStart(2, "0")}`;
                const option = document.createElement("option");
                option.value = val.toString();
                option.text = timeString;
                endTimeSelect.add(option);

                if (firstValidEnd === -1) firstValidEnd = val;
            }
        }

        // Try to keep selected end time if valid, otherwise set to start + 3h (min) or max possible
        const targetEnd = Math.max(startVal + 3, firstValidEnd);

        // Find closest option to targetEnd
        let closestVal = firstValidEnd;
        let minDiff = Math.abs(targetEnd - firstValidEnd);

        Array.from(endTimeSelect.options).forEach((opt) => {
            const val = parseFloat(opt.value);
            const diff = Math.abs(val - targetEnd);
            if (diff < minDiff) {
                minDiff = diff;
                closestVal = val;
            }
        });

        if (endTimeSelect.querySelector(`option[value="${targetEnd}"]`)) {
            endTimeSelect.value = targetEnd.toString();
        } else {
            endTimeSelect.value = closestVal.toString();
        }

        calculatePrice();
    }

    function getOverlap(
        start: number,
        end: number,
        zoneStart: number,
        zoneEnd: number,
    ) {
        const overlapStart = Math.max(start, zoneStart);
        const overlapEnd = Math.min(end, zoneEnd);
        return Math.max(0, overlapEnd - overlapStart);
    }

    function calculatePrice() {
        const start = parseFloat(startTimeSelect.value);
        const end = parseFloat(endTimeSelect.value);

        if (isNaN(start) || isNaN(end)) return;

        let totalHours = end - start;

        // Visual indicator for minimum hours (just red text or similar? For now, we calculate as is but maybe warn?)
        // Spec says "Minimum 3 hours". We will enforce calculation generally but maybe the user selects less.
        // Let's rely on the input logic trying to default to 3h.

        const childrenCount = parseInt(childrenCountSelect.value);

        // Calculate Surcharge Hours
        const earlyHours = getOverlap(start, end, 6, 9);
        const eveningHours = getOverlap(start, end, 18, 20);
        const nightHours = getOverlap(start, end, 20, 23); // Until 23:00 per previous spec

        // Update displays
        totalHoursDisplay.textContent = totalHours.toFixed(1);
        earlyHoursDisplay.textContent =
            earlyHours > 0 ? earlyHours.toFixed(1) : "0";
        eveningHoursDisplay.textContent =
            eveningHours > 0 ? eveningHours.toFixed(1) : "0";
        nightHoursDisplay.textContent =
            nightHours > 0 ? nightHours.toFixed(1) : "0";

        // Price Calc
        // Base Hourly Rate (Base + Sibling + Sick)
        let hourlyRate = BASE_RATE;

        // Sibling Surcharge (+500 per additional child)
        if (childrenCount > 1) {
            hourlyRate += (childrenCount - 1) * 500;
        }

        // Sick Child Surcharge
        if (isSickCheckbox.checked) hourlyRate += 500;

        // Apply Weekend Surcharge to Hourly Rate if applicable (Base Rate + 20%)
        // Interpretation: Is it (Base+Sibling+Sick)*1.2 or (Base)*1.2 + Sibling + Sick?
        // Usually "Basic Charge + 20%" implies the unit price increases.
        // Given text "åŸºæœ¬æ–™é‡‘ã«20%åŠ ç®—", and sibling/sick are often additions to base.
        // However, standard in this industry: (Base + Sibling + Sick) * 1.2 is common for "Holiday Premium".
        // Let's assume it applies to the total hourly unit cost.
        if (isWeekendCheckbox.checked) {
            hourlyRate = hourlyRate * 1.2;
        }

        let total = hourlyRate * totalHours;

        // Add Time Zone Surcharges (flat rates, presumably not affected by weekend 20%? or are they?)
        // Typically time zone surcharges are flat additions.
        // "åŸºæœ¬æ–™é‡‘ + 300å††" implies the +300 is separate.
        total += earlyHours * 300;
        total += eveningHours * 300;
        total += nightHours * 500;

        // Visit Surcharges (Remote)
        if (isRemoteCheckbox.checked) total += 1000;

        // Round to integer
        total = Math.floor(total);

        totalPriceDisplay.textContent = total.toLocaleString();
    }

    // Event Listeners
    startTimeSelect.addEventListener("change", updateEndTimeOptions);
    endTimeSelect.addEventListener("change", calculatePrice);
    childrenCountSelect.addEventListener("change", calculatePrice);
    isWeekendCheckbox.addEventListener("change", calculatePrice);
    isRemoteCheckbox.addEventListener("change", calculatePrice);
    isSickCheckbox.addEventListener("change", calculatePrice);

    // Init
    initTimeOptions();
</script>
